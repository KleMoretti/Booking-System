<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.booking.mapper.BalanceChangeMapper">
    <resultMap id="BalanceChangeResultMap" type="com.booking.entity.BalanceChange">
        <id property="recordId" column="record_id" />
        <result property="userId" column="user_id" />
        <result property="changeAmount" column="change_amount" />
        <result property="balanceBefore" column="balance_before" />
        <result property="balanceAfter" column="balance_after" />
        <result property="changeType" column="change_type" />
        <result property="createTime" column="create_time" />
        <result property="note" column="note" />
    </resultMap>

    <insert id="insert" parameterType="com.booking.entity.BalanceChange" useGeneratedKeys="true" keyProperty="recordId">
        INSERT INTO balance_changes(user_id, change_amount, balance_before, balance_after, change_type, note)
        VALUES(#{userId}, #{changeAmount}, #{balanceBefore}, #{balanceAfter}, #{changeType}, #{note})
    </insert>

    <select id="findByUserId" parameterType="int" resultMap="BalanceChangeResultMap">
        SELECT * FROM balance_changes WHERE user_id = #{userId} ORDER BY create_time DESC
    </select>
</mapper>


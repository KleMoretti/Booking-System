# 车次模板导入 - 快速启动指南

## 🚀 快速开始

### 第一步：初始化数据库

```bash
# 在MySQL中执行以下命令创建模板表
mysql -u root -p booking_system < booking-system-backend/src/main/resources/db/trip_template_schema.sql
```

或在 MySQL 客户端中执行：

```sql
USE booking_system;
SOURCE d:/DataBase/Booking-System/booking-system-backend/src/main/resources/db/trip_template_schema.sql;
```

### 第二步：启动后端服务

```bash
cd booking-system-backend
mvn clean spring-boot:run
```

### 第三步：启动前端服务

```bash
cd booking-system-frontend
npm install
npm run dev
```

### 第四步：使用功能

1. 访问 http://localhost:5173
2. 使用管理员账号登录（admin/admin123）
3. 进入"管理后台" -> "车次模板管理"
4. 点击"下载模板"获取 Excel 模板
5. 填写车次信息后上传

## 📋 Excel 模板示例

创建一个 Excel 文件，包含以下内容：

| 车次号 | 车辆信息 | 总座位数 | 出发站     | 到达站     | 出发时间 | 到达时间 | 基础票价 |
| ------ | -------- | -------- | ---------- | ---------- | -------- | -------- | -------- |
| G1001  | CRH380A  | 556      | 北京南站   | 上海虹桥站 | 08:00    | 12:28    | 553.5    |
| G1002  | CRH380A  | 556      | 上海虹桥站 | 北京南站   | 13:00    | 17:28    | 553.5    |
| D2001  | CRH2A    | 613      | 广州南站   | 深圳北站   | 09:30    | 10:15    | 79.5     |
| D2002  | CRH2A    | 613      | 深圳北站   | 广州南站   | 14:30    | 15:15    | 79.5     |
| G123   | CRH380BL | 556      | 杭州东站   | 上海虹桥站 | 10:00    | 11:00    | 73.0     |

**注意事项：**

1. 第一行必须是表头
2. 出发站和到达站必须是系统中已存在的站点
3. 时间格式必须是 HH:mm（24 小时制）
4. 车次号必须唯一

## 🔍 测试步骤

### 1. 测试正常导入

创建一个包含上述示例数据的 Excel 文件：

```csv
车次号,车辆信息,总座位数,出发站,到达站,出发时间,到达时间,基础票价
G1001,CRH380A,556,北京南站,上海虹桥站,08:00,12:28,553.5
D2001,CRH2A,613,广州南站,深圳北站,09:30,10:15,79.5
```

保存为 `trip_template_test.csv` 或 `.xlsx` 格式，然后上传。

预期结果：

- 成功导入 2 条记录
- 在列表中可以看到新增的模板

### 2. 测试错误处理

创建一个包含错误的 Excel 文件：

```csv
车次号,车辆信息,总座位数,出发站,到达站,出发时间,到达时间,基础票价
G1001,CRH380A,556,北京南站,上海虹桥站,08:00,12:28,553.5
G9999,CRH380A,556,不存在的站点,上海虹桥站,08:00,12:28,553.5
G1001,CRH380A,556,北京南站,上海虹桥站,08:00,12:28,553.5
```

预期结果：

- 第一行成功
- 第二行失败（站点不存在）
- 第三行失败（车次号重复）
- 显示详细的错误信息

### 3. 测试查询功能

导入成功后：

1. 在列表中查看所有模板
2. 点击"详情"查看单个模板的完整信息
3. 验证数据正确性

### 4. 测试删除功能

1. 选择一个模板
2. 点击"删除"按钮
3. 确认删除
4. 验证模板已从列表中移除

## 📝 API 测试（可选）

使用 Postman 或 curl 测试 API：

### 导入 Excel

```bash
curl -X POST http://localhost:8080/api/admin/trip-templates/import \
  -H "Content-Type: multipart/form-data" \
  -F "file=@trip_template_test.xlsx"
```

### 查询所有模板

```bash
curl http://localhost:8080/api/admin/trip-templates/list
```

### 删除模板

```bash
curl -X DELETE http://localhost:8080/api/admin/trip-templates/1
```

## ⚠️ 常见问题

### 1. 导入时提示"站点不存在"

**解决方法：** 先在"站点管理"中添加相应的站点

### 2. 时间格式错误

**解决方法：** 确保时间格式为 HH:mm，如 08:00、13:30

### 3. 车次号重复

**解决方法：**

- 删除已存在的模板
- 或修改新车次的车次号

### 4. Excel 文件无法上传

**解决方法：**

- 检查文件格式（只支持.xlsx 和.xls）
- 检查文件大小（建议小于 10MB）

## 📊 验证数据

导入成功后，可以在数据库中验证：

```sql
USE booking_system;

-- 查看所有模板
SELECT * FROM trip_templates;

-- 查看模板总数
SELECT COUNT(*) FROM trip_templates;

-- 查看某个车次的详细信息
SELECT
    t.*,
    ds.station_name as departure_station_name,
    as.station_name as arrival_station_name
FROM trip_templates t
LEFT JOIN stations ds ON t.departure_station_id = ds.station_id
LEFT JOIN stations as ON t.arrival_station_id = as.station_id
WHERE t.trip_number = 'G1001';
```

## 🎯 成功标准

功能正常的标志：

- ✅ 能成功上传 Excel 文件
- ✅ 正确的数据能导入数据库
- ✅ 错误的数据能给出明确提示
- ✅ 能在列表中查看所有模板
- ✅ 能查看单个模板的详细信息
- ✅ 能删除不需要的模板
- ✅ 数据库中的数据与 Excel 一致

## 📞 技术支持

如遇到问题：

1. 检查后端日志：`booking-system-backend/logs/`
2. 检查浏览器控制台的错误信息
3. 查看数据库表结构是否正确创建
4. 确认所有依赖已正确安装

## 🔄 后续步骤

模板导入成功后，可以：

1. 使用这些模板批量创建实际车次
2. 根据需要调整票价
3. 设置不同日期的车次
4. 管理座位分配

---

**祝使用愉快！** 🎉
